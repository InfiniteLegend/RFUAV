Index: graphic/DrawComprehension.m
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>% 全带的\r\n%% 多种频率分辨率以及颜色映射画图\r\nclc;clear;close all;\r\nfs = 100e6;                     % 输入采样率\r\nfftpoint = [128,256,512,1024];\r\ntime_sec = 0.1;                   % 需要的分割时间/s\r\ndataform = 'float32';           % 输入的数据类型\r\nbyte_per = 4;                   % 该数据类型占字节数\r\ndatalength = time_sec*fs*byte_per*2;       % 读取数据的长度，单位是字节(时间*采样率*每个数据占字节*iq)\r\nfile_input =\"E:\\Drone_dataset\\RFUAV\\rawdata\\DJI AVATA2\\DJI AVTA2-SNR2dB-85db_5775m_100m_60m(1).iq\";% 输入路径\r\n[filepath, name, ~] = fileparts(file_input); % 获取路径、文件名和后缀名，在原路径创建文件夹存放分割后数据\r\nmyname = char(name);\r\nflytype = string(myname(1:end-30));\r\nfilepath = filepath + '\\' + name;\r\ncolor = [\"hsv\",\"hot\",\"autumn\"];\r\nif ~exist(filepath,\"dir\")\r\n    mkdir(filepath);\r\nelse\r\n    disp(\"文件夹已经存在!\");\r\nend\r\n% 读取文件,获取大小\r\nfp = fopen(file_input, 'rb'); \r\nfseek(fp, 0, 1);\r\nfileSize = ftell(fp);\r\nfclose(fp);\r\nreadtime = ceil(fileSize/datalength);\r\n%% 畫3D圖\r\nfp = fopen(file_input, 'rb'); \r\ndata = fread(fp,datalength/4,'float32');\r\ndataIQ = data(1:2:end-1) + 1i * data(2:2:end);\r\nstft(dataIQ,fs,FFTLength=512);\r\nview(-45,45);\r\nyticks([-50 :10:50]);\r\nyticklabels([5725:10:5825]);\r\nxticks([0:10:100]);\r\nxticklabels([0:0.1/10:0.1]);\r\nxlabel(\"时间(s)\");\r\n\r\n%% 分次读取文件保存\r\nfor i =1:readtime\r\n    tic\r\n    fp = fopen(file_input, 'rb'); \r\n    fseek(fp,(i-1)*datalength,-1);\r\n    data = fread(fp,datalength/4,dataform);\r\n    dataIQ = data(1:2:end-1) + 1i * data(2:2:end);\r\n    fclose(fp);\r\n    time = 2;\r\n    for j = 1:4\r\n        for k = 1:3\r\n            stft(dataIQ,fs,FFTLength=fftpoint(j));\r\n            colormap(color(k));\r\n            yticks([-50 :10:50]);\r\n            yticklabels([5710:10:5810]);\r\n            xticks([0:10:100]);\r\n            xticklabels([0:0.1/10:0.1]);\r\n            xlabel(\"时间(s)\");\r\n            title(flytype);\r\n            newFile = fullfile(filepath,num2str(i*0.1-0.1+time) + \"-\" + num2str(i*0.1+time) + \"s-\" +...\r\n                color(k) + \"-\" + num2str(fftpoint(j)) + \".jpg\"); % 生成新的文件路径和文件名\r\n            saveas(gcf,newFile);\r\n        end\r\n    end\r\n    toc\r\nend
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/graphic/DrawComprehension.m b/graphic/DrawComprehension.m
--- a/graphic/DrawComprehension.m	(revision 12ec0c43a29c0bfa8b5d8fcae27a30a652f4464d)
+++ b/graphic/DrawComprehension.m	(date 1732864752813)
@@ -7,58 +7,76 @@
 dataform = 'float32';           % 输入的数据类型
 byte_per = 4;                   % 该数据类型占字节数
 datalength = time_sec*fs*byte_per*2;       % 读取数据的长度，单位是字节(时间*采样率*每个数据占字节*iq)
-file_input ="E:\Drone_dataset\RFUAV\rawdata\DJI AVATA2\DJI AVTA2-SNR2dB-85db_5775m_100m_60m(1).iq";% 输入路径
-[filepath, name, ~] = fileparts(file_input); % 获取路径、文件名和后缀名，在原路径创建文件夹存放分割后数据
-myname = char(name);
-flytype = string(myname(1:end-30));
-filepath = filepath + '\' + name;
-color = ["hsv","hot","autumn"];
-if ~exist(filepath,"dir")
-    mkdir(filepath);
-else
-    disp("文件夹已经存在!");
-end
-% 读取文件,获取大小
-fp = fopen(file_input, 'rb'); 
-fseek(fp, 0, 1);
-fileSize = ftell(fp);
-fclose(fp);
-readtime = ceil(fileSize/datalength);
-%% 畫3D圖
-fp = fopen(file_input, 'rb'); 
-data = fread(fp,datalength/4,'float32');
-dataIQ = data(1:2:end-1) + 1i * data(2:2:end);
-stft(dataIQ,fs,FFTLength=512);
-view(-45,45);
-yticks([-50 :10:50]);
-yticklabels([5725:10:5825]);
-xticks([0:10:100]);
-xticklabels([0:0.1/10:0.1]);
-xlabel("时间(s)");
+file_in ="E:\DataBase\DJFPVCOMBO-22db-90db_5760m_100m_40m\DJFPVCOMBO-22db-90db_5760m_100m_40m_noise\DJFPVCOMBO-22db-90db_5760m_100m_40m_8-10s-noise";% 输入路径
+% 获取文件夹内所有iq/dat文件
+% 检索 .dat 文件
+files_dat = dir(fullfile(file_in, '*.dat'));
+% 检索 .iq 文件
+files_iq = dir(fullfile(file_in, '*.iq'));
+% 合并两个结果
+files = [files_dat; files_iq];
+% 一级循环，遍历文件
+for ii = 1:length(files)
+    fileName{ii} = files(ii).name;
+    file_input = fullfile(file_in,fileName{ii});
+%     % 从文件名判断无人机机型
+%     myname = char(fileName{ii});
+%     for i = 1:length(myname)
+%         if strcmp(myname(i), '-')
+%             flytype = string(myname(1:i-1));
+%             break; % 找到第一个 '-' 后退出循环
+%         end
+%     end
+    filepathOut = "E:\DataBase\stftFig";
+    filepathOut_get = filepathOut + '\' + fileName{ii}(1:end-4);
+%     filepathOut = filepathOut + flytype + '\' + fileName{ii}(1:end-3);
+    color = ["parula","hsv","hot","autumn"];
+%     color = ["parula"];
+%     ,"parula" 后续添加
+%     if ~exist(filepathOut,"dir")
+%         mkdir(filepathOut);
+%     else
+%         disp("文件夹已经存在!");
+%     end
+    % 读取文件,获取大小
+    fp = fopen(file_input, 'rb');
+    fseek(fp, 0, 1);
+    fileSize = ftell(fp);
+    fclose(fp);
+    readtime = ceil(fileSize/datalength);
 
-%% 分次读取文件保存
-for i =1:readtime
-    tic
-    fp = fopen(file_input, 'rb'); 
-    fseek(fp,(i-1)*datalength,-1);
-    data = fread(fp,datalength/4,dataform);
-    dataIQ = data(1:2:end-1) + 1i * data(2:2:end);
-    fclose(fp);
-    time = 2;
-    for j = 1:4
-        for k = 1:3
-            stft(dataIQ,fs,FFTLength=fftpoint(j));
-            colormap(color(k));
-            yticks([-50 :10:50]);
-            yticklabels([5710:10:5810]);
-            xticks([0:10:100]);
-            xticklabels([0:0.1/10:0.1]);
-            xlabel("时间(s)");
-            title(flytype);
-            newFile = fullfile(filepath,num2str(i*0.1-0.1+time) + "-" + num2str(i*0.1+time) + "s-" +...
-                color(k) + "-" + num2str(fftpoint(j)) + ".jpg"); % 生成新的文件路径和文件名
-            saveas(gcf,newFile);
-        end
-    end
-    toc
+    %% 分次读取文件保存
+    time = 0;
+    for i =1:readtime
+        tic
+        fp = fopen(file_input, 'rb');
+        fseek(fp,(i-1)*datalength,-1);
+        data = fread(fp,datalength/4,dataform);
+        fclose(fp);
+        dataIQ = data(1:2:end-1) + 1i * data(2:2:end);
+        clear data;
+        for j = 1:length(fftpoint)
+            for k = 1:length(color)
+                stft(dataIQ,fs,FFTLength=fftpoint(j));
+                colormap(color(k));
+                yticks([-50 :10:50]);
+                yticklabels([5710:10:5810]);
+                xticks([0:10:100]);
+                xticklabels([0:0.1/10:0.1]);
+                xlabel("时间(s)");
+                title(fileName{ii}(1:end-4));
+%                 title(flytype);
+                filepathOut = filepathOut_get + '\'+ color(k) + '\'+num2str(fftpoint(j));
+                if ~exist(filepathOut,"dir")
+                    mkdir(filepathOut);
+                end
+                newFile = fullfile(filepathOut,num2str(2+i*0.1-0.1+time) + "-" + num2str(2+i*0.1+time) + "s-" +...
+                    color(k) + "-" + num2str(fftpoint(j)) + ".jpg"); % 生成新的文件路径和文件名
+                set(gcf, 'Units', 'inches', 'Position', [0, 0, 8, 6]);
+                print(gcf, newFile, '-dpng', '-r300');
+                clf;
+            end
+        end
+        toc
+    end
 end
\ No newline at end of file
